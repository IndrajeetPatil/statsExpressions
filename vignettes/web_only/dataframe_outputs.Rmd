---
title: "Data frame outputs"
author: "Indrajeet Patil"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 4
vignette: >
  %\VignetteIndexEntry{Data frame outputs}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
#| label = "setup",
#| message = FALSE,
#| warning = FALSE,
#| include = FALSE,
#| echo = FALSE
source("../setup.R")

knitr::opts_chunk$set(
  eval = requireNamespace("ggplot2", quietly = TRUE) &&
    requireNamespace("afex", quietly = TRUE) &&
    requireNamespace("metaplus", quietly = TRUE)
)
```

This vignette can be cited as:

```{r}
#| label = "citation",
#| echo = FALSE,
#| comment = ""
citation("statsExpressions")
```

## One-sample tests

```{r}
#| label = "onesample"

# ----------------------- parametric ---------------------------------------

set.seed(123)
one_sample_test(
  data       = ggplot2::msleep,
  x          = brainwt,
  test.value = 0.275,
  type       = "parametric"
)

# ----------------------- non-parametric -----------------------------------

set.seed(123)
one_sample_test(
  data       = ggplot2::msleep,
  x          = brainwt,
  test.value = 0.275,
  type       = "nonparametric"
)

# ----------------------- robust --------------------------------------------

set.seed(123)
one_sample_test(
  data       = ggplot2::msleep,
  x          = brainwt,
  test.value = 0.275,
  type       = "robust"
)

# ----------------------- Bayesian ---------------------------------------

set.seed(123)
one_sample_test(
  data       = ggplot2::msleep,
  x          = brainwt,
  test.value = 0.275,
  type       = "bayes",
  bf.prior   = 0.8
)
```

## Two-sample tests

### within-subjects design

```{r}
#| label = "twosample_w"

# data
df <- dplyr::filter(bugs_long, condition %in% c("LDLF", "LDHF"))

# ----------------------- parametric ---------------------------------------

set.seed(123)
two_sample_test(
  data       = df,
  x          = condition,
  y          = desire,
  paired     = TRUE,
  subject.id = subject,
  type       = "p"
)

# ----------------------- non-parametric -----------------------------------

set.seed(123)
two_sample_test(
  data       = df,
  x          = condition,
  y          = desire,
  paired     = TRUE,
  subject.id = subject,
  type       = "np"
)

# ----------------------- robust --------------------------------------------

set.seed(123)
two_sample_test(
  data       = df,
  x          = condition,
  y          = desire,
  paired     = TRUE,
  subject.id = subject,
  type       = "r"
)

# ----------------------- Bayesian ---------------------------------------

set.seed(123)
two_sample_test(
  data       = df,
  x          = condition,
  y          = desire,
  paired     = TRUE,
  subject.id = subject,
  type       = "bayes"
)
```

### between-subjects design

```{r}
#| label = "twosample_b"

# ----------------------- parametric ---------------------------------------

# unequal variance
set.seed(123)
two_sample_test(
  data      = ToothGrowth,
  x         = supp,
  y         = len,
  type      = "p"
)

# equal variance
set.seed(123)
two_sample_test(
  data      = ToothGrowth,
  x         = supp,
  y         = len,
  var.equal = TRUE,
  type      = "p"
)

# ----------------------- non-parametric -----------------------------------

set.seed(123)
two_sample_test(
  data      = ToothGrowth,
  x         = supp,
  y         = len,
  type      = "np"
)

# ----------------------- robust --------------------------------------------

set.seed(123)
two_sample_test(
  data      = ToothGrowth,
  x         = supp,
  y         = len,
  type      = "r"
)

# ----------------------- Bayesian ---------------------------------------

set.seed(123)
two_sample_test(
  data      = ToothGrowth,
  x         = supp,
  y         = len,
  type      = "bayes"
)
```

## One-way ANOVAs

### within-subjects design

```{r}
#| label = "anova_w"
library(afex)

# ----------------------- parametric ---------------------------------------

set.seed(123)
oneway_anova(
  data       = bugs_long,
  x          = condition,
  y          = desire,
  paired     = TRUE,
  subject.id = subject,
  type       = "p"
)

# ----------------------- non-parametric -----------------------------------

set.seed(123)
oneway_anova(
  data       = bugs_long,
  x          = condition,
  y          = desire,
  paired     = TRUE,
  subject.id = subject,
  type       = "np"
)

# ----------------------- robust --------------------------------------------

set.seed(123)
oneway_anova(
  data       = bugs_long,
  x          = condition,
  y          = desire,
  paired     = TRUE,
  subject.id = subject,
  type       = "r"
)

# ----------------------- Bayesian ---------------------------------------

set.seed(123)
oneway_anova(
  data       = bugs_long,
  x          = condition,
  y          = desire,
  paired     = TRUE,
  subject.id = subject,
  type       = "bayes"
)
```

### between-subjects design

```{r}
#| label = "anova_b"

# ----------------------- parametric ---------------------------------------

# unequal variance
set.seed(123)
oneway_anova(
  data      = iris,
  x         = Species,
  y         = Sepal.Length,
  type      = "p"
)

# equal variance
set.seed(123)
oneway_anova(
  data      = iris,
  x         = Species,
  y         = Sepal.Length,
  var.equal = TRUE,
  type      = "p"
)

# ----------------------- non-parametric -----------------------------------

set.seed(123)
oneway_anova(
  data      = iris,
  x         = Species,
  y         = Sepal.Length,
  type      = "np"
)

# ----------------------- robust --------------------------------------------

set.seed(123)
oneway_anova(
  data      = iris,
  x         = Species,
  y         = Sepal.Length,
  type      = "r"
)

# ----------------------- Bayesian ---------------------------------------

set.seed(123)
oneway_anova(
  data      = iris,
  x         = Species,
  y         = Sepal.Length,
  type      = "bayes"
)
```

## Contingency table analyses

### association test

```{r}
#| label = "conttabs"

# ------------------------ frequentist -----------------------------

# unpaired
set.seed(123)
contingency_table(
  data   = mtcars,
  x      = am,
  y      = cyl,
  paired = FALSE
)

# paired
## create data structure
paired_data <-
  structure(
    list(
      response_before =
        structure(
          c(1L, 2L, 1L, 2L),
          .Label = c("no", "yes"),
          class = "factor"
        ),
      response_after = structure(
        c(1L, 1L, 2L, 2L),
        .Label = c("no", "yes"),
        class = "factor"
      ),
      Freq = c(65L, 25L, 5L, 5L)
    ),
    class = "data.frame",
    row.names = c(NA, -4L)
  )


set.seed(123)
contingency_table(
  data   = paired_data,
  x      = response_before,
  y      = response_after,
  paired = TRUE,
  counts = "Freq"
)

# ------------------------ Bayesian -----------------------------

# unpaired
set.seed(123)
contingency_table(
  data   = mtcars,
  x      = am,
  y      = cyl,
  paired = FALSE,
  type   = "bayes"
)
```

### goodness-of-fit tests

```{r}
#| label = "gof"
# ------------------------ frequentist -----------------------------

# with counts
set.seed(123)
contingency_table(
  data   = as.data.frame(HairEyeColor),
  x      = Eye,
  counts = Freq,
)

# ------------------------ Bayesian -----------------------------

set.seed(123)
contingency_table(
  data   = as.data.frame(HairEyeColor),
  x      = Eye,
  counts = Freq,
  ratio  = c(0.2, 0.2, 0.3, 0.3),
  type   = "bayes"
)
```

## Correlation analyses

```{r}
#| label = "corr"
set.seed(123)
library(statsExpressions)

# ----------------------- parametric ---------------------------------------

set.seed(123)
corr_test(
  data = mtcars,
  x    = wt,
  y    = mpg,
  type = "parametric"
)

# ----------------------- non-parametric -----------------------------------

set.seed(123)
corr_test(
  data = mtcars,
  x    = wt,
  y    = mpg,
  type = "nonparametric"
)

# ----------------------- robust --------------------------------------------

set.seed(123)
corr_test(
  data = mtcars,
  x    = wt,
  y    = mpg,
  type = "robust"
)

# ----------------------- Bayesian ---------------------------------------

set.seed(123)
corr_test(
  data = mtcars,
  x    = wt,
  y    = mpg,
  type = "bayes"
)
```

## Meta-analysis

```{r}
#| label = "meta",
#| eval = FALSE
library(metaplus)

# renaming to what `{statsExpressions}` expects
df <- dplyr::rename(mag, estimate = yi, std.error = sei)

# ----------------------- parametric ---------------------------------------

set.seed(123)
meta_analysis(df, type = "parametric")

# ----------------------- robust --------------------------------------------

set.seed(123)
meta_analysis(df, type = "robust")

# ----------------------- Bayesian ---------------------------------------

set.seed(123)
meta_analysis(df, type = "bayes")
```

## Centrality description

```{r}
#| label = "centrality",
#| file = "../../man/examples/examples-centrality_description.R"
```

## Pairwise comparisons for one-way design

### Between-subjects design

```{r}
# ----------------------- parametric -----------------------

# if `var.equal = TRUE`, then Student's *t*-test will be run
pairwise_comparisons(
  data            = ggplot2::msleep,
  x               = vore,
  y               = brainwt,
  type            = "parametric",
  var.equal       = TRUE,
  paired          = FALSE,
  p.adjust.method = "bonferroni"
)

# if `var.equal = FALSE`, then Games-Howell test will be run
pairwise_comparisons(
  data            = ggplot2::msleep,
  x               = vore,
  y               = brainwt,
  type            = "parametric",
  var.equal       = FALSE,
  paired          = FALSE,
  p.adjust.method = "bonferroni"
)

# ----------------------- non-parametric -------------------

pairwise_comparisons(
  data            = ggplot2::msleep,
  x               = vore,
  y               = brainwt,
  type            = "nonparametric",
  paired          = FALSE,
  p.adjust.method = "none"
)

# ----------------------- robust ---------------------------

pairwise_comparisons(
  data            = ggplot2::msleep,
  x               = vore,
  y               = brainwt,
  type            = "robust",
  paired          = FALSE,
  p.adjust.method = "fdr"
)

# ----------------------- Bayesian -------------------------

pairwise_comparisons(
  data   = ggplot2::msleep,
  x      = vore,
  y      = brainwt,
  type   = "bayes",
  paired = FALSE
)
```


### Within-subjects design

```{r}
# ----------------------- parametric -----------------------

pairwise_comparisons(
  data            = bugs_long,
  x               = condition,
  y               = desire,
  subject.id      = subject,
  type            = "parametric",
  paired          = TRUE,
  p.adjust.method = "BH"
)

# ----------------------- non-parametric -------------------

pairwise_comparisons(
  data            = bugs_long,
  x               = condition,
  y               = desire,
  subject.id      = subject,
  type            = "nonparametric",
  paired          = TRUE,
  p.adjust.method = "BY"
)

# ----------------------- robust ---------------------------

pairwise_comparisons(
  data            = bugs_long,
  x               = condition,
  y               = desire,
  subject.id      = subject,
  type            = "robust",
  paired          = TRUE,
  p.adjust.method = "hommel"
)

# ----------------------- Bayesian -------------------------

pairwise_comparisons(
  data       = bugs_long,
  x          = condition,
  y          = desire,
  subject.id = subject,
  type       = "bayes",
  paired     = TRUE,
  bf.prior   = 0.77
)
```

## Suggestions

If you find any bugs or have any suggestions/remarks, please file an issue on GitHub: <https://github.com/IndrajeetPatil/statsExpressions/issues>
